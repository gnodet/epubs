<sile papersize="a5" class="bible" twocolumns="true">
<font size="8pt" language="fr"/>
<script src="packages/grid"/>
<script src="packages/frametricks"/>
<script src="packages/raiselower"/>
<grid spacing="10pt"/>
<script>
SILE.require("packages/counters");

SILE.settings.set("typesetter.parseppattern", "[\t\n]+")
SILE.settings.set("document.baselineskip", SILE.nodefactory.newVglue("0pt"))
SILE.settings.set("document.parskip", SILE.nodefactory.newVglue("0pt"))
SILE.settings.set("document.parindent", SILE.nodefactory.newGlue("0pt"))

SILE.registerCommand("verse", function(options, content)
  local c = options.ch
  local v = options.vs
  SILE.call("break", {}, {})
  if (v == "1") then
    io.write(" ("..c..") ")
    SU.debug("test", "Calling chapter: "..c)
    SILE.call("chapter-number", o, {c})
    SILE.call("save-chapter-number",{},{c})
  else
    SILE.process({" "})
  end
  SU.debug("test", "Processing: "..c..","..v)
  SILE.call("verse-number",{},{v})
  SILE.process(content)
end)

SILE.registerCommand("book", function(options, content)
  local node = SILE.findInTree(content, "title") or SILE.findInTree(content, "h2")
  local title
  SU.debug("test", "node: "..node)
  for _,t in ipairs(node) do
    SU.debug("test", t.."("..type(t)..")")
    if type(t) == "string" then
      title = t
    end
  end
  SU.debug("test", "title: "..title)
  SILE.scratch.book = title
  SILE.call("book-title", options, {title})
  SILE.process(content)
end)

SILE.registerCommand("break", function(options, content)
  if SILE.scratch.isBreaking then
    SILE.typesetter:leaveHmode()
    SILE.scratch.isBreaking = false
  else
    SILE.scratch.isBreaking = true
  end
end)

SILE.documentState.documentClass.endPar = function(typesetter)
end

SILE.registerCommand("xi:include", function(options, content)
  SILE.call("include", {src=options.href}, {})
end)

SILE.registerCommand("section", function(options, content)
  if not(options.type == "intro") then
    SILE.process(content)
  end
end)

</script>
<define command="book-title"><center><skip height="1cm"/><font weight="700" size="20pt"><process/></font><skip height="0.5cm"/></center></define>
<define command="chapter-number"><font size="24pt"><process/></font></define>
<define command="bible:verse-number"><raise height="3pt"><font size="6pt"><process/></font></raise><thinspace/></define>

<define command="bible"><process/></define>
<define command="h1"/>
<define command="h2"/>
<define command="h3"/>
<define command="h4"/>
<define command="h5"/>
<define command="div"/>
<define command="title"/>
<define command="head"/>
<define command="p"><process/><break/></define>
<define command="chapter"><process/></define>
<define command="w"><process/></define>
<define command="u"><process/></define>
<define command="i"><em><process/></em></define>
<define command="cite"><em><process/></em></define>
<define command="bible"><process/></define>
<define command="ss"><font style="italic"><process/></font></define>
<define command="sc"><process/></define>
<define command="sv"><process/></define>
<define command="phrase"><process/></define>
<define command="ol"><process/></define>
<define command="li"><process/></define>
<define command="marginnote"></define>
<define command="footnote"></define>
<define command="sup"><raise height="3pt"><process/></raise></define>
<define command="br"><break/></define>
<define command="nobreak"><!--script>SILE.typesetter:pushPenalty({penalty = 10000 })</script--></define>
<define command="novbreak"><!--script>SILE.typesetter:pushVpenalty({penalty = 10000 })</script--></define>

<!-- <include src="../books/Matthieu.xhtml"/> -->
</sile>
